<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Mongomapper.net by emiliotorrens</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Mongomapper.net</h1>
        <p>A .NET Object Mapper for MongoDB over MongoDB C# Driver</p>
        <p class="view"><a href="https://github.com/emiliotorrens/MongoMapper.NET">View the Project on GitHub <small>emiliotorrens/MongoMapper.NET</small></a></p>
        <ul>
          <li><a href="https://github.com/emiliotorrens/MongoMapper.NET/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/emiliotorrens/MongoMapper.NET/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/emiliotorrens/MongoMapper.NET">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>MongoMapper.NET</h2>

<p>A .NET Object Mapper for MongoDB over MongoDB C# Driver</p>

<h3>Dependencies</h3>

<ul>
<li><a href="http://www.mongodb.org/downloads">MongoDB distributions</a></li>
<li><a href="http://github.com/mongodb/mongo-csharp-driver">MongoDB Driver for CSharp</a></li>
<li><a href="http://github.com/ServiceStack/ServiceStack.Text">ServiceStack.Text</a></li>
<li>
<a href="http://www.nunit.org">NUnit</a>, <a href="http://nunitforvs.codeplex.com">NUnit for Visual Studio</a>
</li>
</ul><h3>Defining the Model</h3>

<pre><code>[MongoKey(KeyFields = "Code")]
public class Country: MongoMapper
{        
    [MongoDownRelation(ObjectName = "Person", FieldName = "Country")]
    public string Code { get; set; }
    public string Name { get; set; }

    [MongoPropertyValidator(PropertyName="Code")]
    public void CodeIsUp(string CountryCode)
    {
        if (CountryCode != CountryCode.ToUpper())
            throw new Exception(String.Format("{0} must be {1}", CountryCode, CountryCode.ToUpper()));
    }
}

[MongoKey(KeyFields = "")]
[MongoIndex(IndexFields = "ID,Country")]
[MongoIndex(IndexFields =  "Name")]
[MongoMapperIdIncrementable(IncremenalId = true, ChildsIncremenalId = true)]
public class Person : MongoMapper
{        
    public Person()
    {
        Childs = new List&lt;Child&gt;();
    }

    public string Name { get; set; }
    public int Age { get; set; }
    public DateTime BirthDate { get; set; }
    public bool Married { get; set; }
    public decimal BankBalance { get; set; }

    [MongoUpRelation(ObjectName = "Country", FieldName = "Code")]
    public string Country { get; set; }

    [MongoChildCollection]
    public List&lt;Child&gt; Childs { get; set;}
}
</code></pre>

<h3>Work with the Model</h3>

<pre><code>    Country c = new Country {Code = "es", Name = "Espa√±a"};
    try
    {
        c.Save();
    }
    catch(Exception ex)
    {
        Assert.AreEqual(ex.GetBaseException().GetType(), typeof(ValidatePropertyException)); 
        c.Code = "ES";
        c.Save();
    }

    c = new Country { Code = "UK", Name = "Reino Unido" };
    c.Save();

    c = new Country { Code = "UK", Name = "Reino Unido" };
    try
    {
        c.Save();
    }
    catch (Exception ex)
    {
        Assert.AreEqual(ex.GetBaseException().GetType(),typeof(DuplicateKeyException)); 
    }

    Country c2 = new Country { Code = "US", Name = "Francia" };
    c2.OnBeforeInsert += (s, e) =&gt; { ((Country)s).Name = "Estados Unidos"; };            
    c2.Save();

    Country c3 = new Country();
    c3.FillByKey("US");
    Assert.AreEqual(c3.Name, "Estados Unidos");

    List&lt;Country&gt; countries = new List&lt;Country&gt;();
    countries.MongoFind();
    Assert.AreEqual(countries.Count, 3);

    countries.MongoFind(Query.Or(MongoQuery.Eq((Country co) =&gt; co.Code, "ES"), MongoQuery.Eq((Country co) =&gt; co.Code, "UK")));
    Assert.AreEqual(countries.Count, 2);

    Person p = new Person
    {
        Name = "Pepito Perez",
        Age = 35,
        BirthDate = DateTime.Now.AddDays(57).AddYears(-35),
        Married = true,
        Country = "XXXXX",
        BankBalance = decimal.Parse("3500,00")
    };

    p.Childs.Add(new Child() { ID = 1, Age = 10, BirthDate = DateTime.Now.AddDays(57).AddYears(-10), Name = "Juan Perez" });        

    try
    {
        p.Save();
    }
    catch (Exception ex)
    {
        Assert.AreEqual(ex.GetBaseException().GetType(), typeof(ValidateUpRelationException));
        p.Country = "ES";
        p.Save();
    }   

    p.ServerUpdate(Update.PushWrapped("Childs", new Child() { ID = 2, Age = 2, BirthDate = DateTime.Now.AddDays(57).AddYears(-7), Name = "Ana Perez" }));       

    List&lt;Person&gt; persons = new List&lt;Person&gt;();
    persons.MongoFind("Childs.Age",2);
    Assert.AreEqual(persons.Count, 1);
</code></pre>

<h3>You can find examples in the Test Project</h3>

<ul>
<li>
<a href="https://github.com/emiliotorrens/MongoMapper.NET/tree/master/EtoolTech.MongoDB.Mapper.Test.NUnit/Classes">Class Definition</a> </li>
<li><a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/FindTest.cs">Find</a></li>
<li><a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/InsertModifyDeleteTest.cs">Write</a></li>
<li><a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/IncrementalIdTest.cs">Incremental ID</a></li>
<li>
<a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/RelationsTest.cs">Relations</a> </li>
<li><a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/EventsTest.cs">Events</a></li>
<li><a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/ExtensionTest.cs">Extension Methods</a></li>
<li><a href="https://github.com/emiliotorrens/MongoMapper.NET/blob/master/EtoolTech.MongoDB.Mapper.Test.NUnit/OriginalObjectTest.cs">Original Version</a></li>
</ul><h3>Change Log</h3>

<ul>
<li><a href="http://bit.ly/uy80RE">30/12/2011</a></li>
<li><a href="http://bit.ly/yfcsn4">05/01/2012</a></li>
<li><a href="http://bit.ly/AfGfKC">02/02/2012</a></li>
<li><a href="http://bit.ly/zvnk0F">14/02/2012</a></li>
<li><a href="http://bit.ly/wMX6Ha">07/03/2012</a></li>
<li><a href="http://bit.ly/GAIbez">20/03/2012</a></li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/emiliotorrens">emiliotorrens</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
    
  </body>
</html>